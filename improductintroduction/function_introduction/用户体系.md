#  用户体系

环信只是即时通讯的消息通道，本身不提供用户体系。要使用环信即时通讯 IM，你需要在客户端和服务端集成用户体系。

![img][用户体系.png]

## 服务器端集成

### 将 App 的用户集成到环信 IM

环信即时通讯 IM 提供 [REST API](/document/server-side/account_system.html#注册用户) 注册环信用户账号。该接口简单易用，只需提供用户 ID 和密码，即可注册一个环信账号。对于一个已上线的有很多现有用户的 app，要集成环信即时通讯 IM，你只需写一个脚本，循环调用注册环信用户的 REST 方法即可。

// TODO：跟东海确认
| 字段名  | 数据类型 | 描述                                                         |
| :------- | :------- | :----------------------------------------------------------- |
| `username` |  String   | 环信 IM 用户 ID，在 App Key 的范围内唯一。该字段可以和 App 现有用户体系的用户的 primary key 相同。这样，你无需对现有 app 后台的数据库的用户表做任何修改，例如，无需在用户表增加环信 IM 用户 ID 字段。TODO：“也是第三方用户体系中的 primary key。”是什么意思？ |
| `password` | String   | 用户登录环信 IM 使用的密码。为保证第三方用户体系中的账号密码不必要的泄露给环信，建议对第三方用户体系的账号密码做一次 hash 算法。然后在手机端登录环信时，客户端同样使用 hash 后的密码登录。 |

### App 创建新用户时注册环信账号

为了保证安全，强烈建议只在服务器端调用 [REST API](/document/server-side/account_system.html#注册用户)注册环信账号。也就是说，每次 app 客户端调用 app 自己的业务后台创建新用户时，也在环信即时通讯 IM 上为该 app 用户创建一个环信账号。

通常，在自己的 app 创建用户成功后调用注册环信账号的 REST API 创建环信账号。鉴于该 REST API 是你的 app server 对环信服务器的调用，所以这类调用因为网络不稳定原因失败的可能很小。不过，开发者仍需要对该 API 的返回结果进行处理，若调用失败，应重试，若重试仍旧失败，应该回滚在自己的 app 创建用户的操作，否则会导致 app 的用户账号和环信账号不一致的问题。

### App 修改用户密码时更新环信账号的密码

为了保证安全，强烈建议只在服务器端调用 [REST API](/document/server-side/account_system.html#修改用户密码) 修改环信账号密码。也就是说，每次 app 用户的密码被修改时，也要修改该 app 用户对应的环信账号的密码。

### App 删除用户时删除环信账号

为了保证安全，强烈建议只在服务器端调用 [REST API](/document/server-side/account_system.html#删除用户账号) 删除环信账号。也就是说，每次 app 客户端调用 app 自己的业务后台删除用户时，也在环信即时通讯 IM 上将该 app 用户对应的环信账号删除。

## 客户端集成

- **客户端登录集成**：app 客户端在登录自己的 app 服务器后台成功后，需要调用环信客户端 SDK 的登录方法。

- **客户端退出登录集成**：app 客户端在退出登录自己的 app 服务器后台成功后，需要调用环信客户端 SDK 的退出登录方法。

关于登录的介绍，详见相关[登录文档](/product/login.html)。

## 用户注册模式

用户注册模式分为以下两种：

- 开放注册：一般在体验 Demo 和测试环境时使用，正式环境中不推荐使用该方式注册环信账号。只有开放注册时，才可以使用客户端的创建用户接口注册。相关的 REST API 介绍，详见[开放注册单个用户的接口介绍](/document/server-side/account_system.html#开放注册单个用户)。
- 授权注册：通过环信提供的 REST API 注册环信用户账号，注册后保存到你的服务器或返给客户端。相关的 REST API 介绍，详见[授权注册单个用户](/document/server-side/account_system.html#授权注册单个用户)和[批量授权注册用户](/document/server-side/account_system.html#批量授权注册用户)的接口介绍。

除此以外，可以在环信即时通讯云控制台创建用户，详见[创建用户相关介绍](/product/enable_and_configure_IM.html#创建-im-用户)。
  
**注册用户名会自动转为小写字母，所以建议用户名均以小写注册。**// TODO：可以这么说吗？

