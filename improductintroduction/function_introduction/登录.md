# 登录

初始化环信即时通讯 IM SDK 后，你需要调用登录接口进行登录。只有登录成功后，你才能正常使用 IM 的各种功能，例如消息和会话。

关于创建用户账号，你可以调用[注册用户 REST API](/document/server-side/account_system.html#注册用户)。

目前登录服务器支持主动和自动登录。主动登录有两种方式：

- 用户 ID + 密码
- 用户 ID + token

// TODO： App 内的所有终端用户通过自己的 App 的用户 ID 就可以登录 IM 吗？没有用户映射的概念吧。
// TODO：这个 token 是怎么来的，是 app server 调用环信服务器的 REST 接口生成的？用户从 app server 获取 token，然后再登录到 IM？

| 参数       | 类型   | 是否必需 | 描述          |
| :--------- | :----- | :------- | :-------------------------------------------- |
| `username` | String | 是  | 用户 ID，长度不可超过 64 个字节。不可设置为空。支持以下字符集：<br/>- 26 个小写英文字母 a-z；<br/>- 26 个大写英文字母 A-Z；<br/>- 10 个数字 0-9；<br/>- “_”, “-”, “.”。 <br/><Container type="notice" title="注意"><br/>- 该参数不区分大小写，因此 `Aa` 和 `aa` 为相同的用户 ID；<br/>- 请确保同一个 app 下，用户 ID 唯一；<br/>- 用户 ID 为公开信息，请勿使用 UUID、邮箱地址、手机号等敏感信息。</Container> |
| `token` | String | 是 | token 可以通过调用 REST API 获取，即传入用户 ID （或用户 ID + 密码）和 token 有效期参数获取，详见 [环信用户 token 的获取](/document/server-side/easemob_user_token.html)。<br/><Container type="notice" title="注意"><br/>- 你可以在调用 REST API 获取 token 时，传入 `ttl` 参数，设置 token 的有效期。此外，你也可以通过[环信即时通讯云控制台](https://console.easemob.com/user/login/)的**用户认证**页面设置 token 的有效期。该参数值以最新设置为准。<br/>- 环信服务器完全信赖用户 token，为避免业务受影响，你需要确保 token 的安全。</Container> |
| `password` | String | 是 | 用户的登录密码，长度不可超过 64 个字符。|

调用登录接口后，收到 `onConnected` 回调表明 SDK 与环信服务器连接成功。

:::tip
// TODO：列明哪些接口在非登录的情况下可以调用。
// TODO：下面的说法准确吗？（https://docs-im.easemob.com/im/android/sdk/basic#登录）
除了注册监听，其他的 SDK 操作均需在登录之后才能进行。
登录成功后需要调用EMClient.getInstance().chatManager().loadAllConversations();和EMClient.getInstance().groupManager().loadAllGroups();。
以上两个方法是为了保证进入主页面后本地会话和群组都 load 完毕。
:::

## 登录流程 （产品/研发）

登录即时通讯 IM 的流程如下图所示：

// TODO：补充流程图和步骤描述。

