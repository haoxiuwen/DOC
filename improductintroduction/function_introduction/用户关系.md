# 用户关系

TODO:// 下面是腾讯云的文档，参考写一下环信 IM  的吧。

即时通信 IM 开放了用户关系托管能力，提供关系链相关的一整套完整解决方案。如果你不希望自行开发或维护 App 内用户之间的好友关系，并且轻松玩转加删好友等一系列功能，那么您可以选择即时通信 IM 的关系链托管服务：

- 即时通信 IM 提供关系链的存储能力，并确保你的数据具备异地容灾、多地部署和自动扩容缩容的能力，帮助你从服务器宕机、多拷贝主从复制和扩容缩容等复杂处理流程中得到完全地解放。

- 即时通信 IM 提供业界通用的业务处理流程，帮助你在用户关系链的逻辑上彻底地解放。

- 即时通信 IM 提供专业的运营流程和运营团队，全年 99.99% 的稳定服务质量，帮助你为用户提供具有稳定口碑的服务。

- 即时通信 IM 提供简单易用的服务接口和快捷接入的帮助指引，全程为你提供星级服务。

用户关系是一组用于描述用户和其他用户关系的数据，即时通信 IM 目前支持好友列表和黑名单两种。

// TODO：好友和联系人有啥区别？貌似概念不是很明确

## 联系人列表

你可以对联系人列表进行相关管理操作，包括添加好友、删除好友、从服务端和本地获取好友列表以及导入好友列表。

联系人列表相关的限制，如单个用户的好友数上限，详见[产品使用限制](/product/limitation.html)。

### 添加好友

即时通讯 IM 支持每次添加单个好友。添加好友的流程如下：

- 服务端：调用 REST API 可直接将用户添加至联系人列表，要添加的好友无需确认。
- 客户端：例如，若用户 A 添加用户 B 为好友：用户 A 申请添加用户 B，用户 B 接到好友邀请后，选择同意或拒绝成为好友；若同意，则添加好友成功，则用户 A 和 B 均被添加到对方的联系人列表中。若拒绝，则添加好友失败。

好友表中的好友信息如下：

- 为哪个用户添加的好友。
- 好友的用户 ID。
- 好友备注（如果调用添加好友备注接口进行了设置）。
  
### 删除好友

即时通讯 IM 支持每次删除单个好友。删除好友的同时会删除对方联系人列表中的该用户。

删除操作不需要对方同意或者拒绝。此外，删除联系人时支持选择是否保留其会话和消息。

### 获取好友列表

- 服务端：可调用推荐的方法分页或一次性获取好友列表，其中每个好友对象包含好友的用户 ID 和好友备注。
         不过，你也可以调用之前的方法一次性获取所有好友的列表，该列表只包含好友的用户 ID。
- 客户端：1. 可调用推荐的方法一次性获取好友列表，其中每个好友对象包含好友的用户 ID 和好友备注。
         不过，你也可以调用之前的方法一次性获取所有好友的列表，该列表只包含好友的用户 ID。 
         2. 可获取本地单个好友的信息，包括好友的用户 ID 和好友备注。
   
:::tip
需要从服务器获取好友列表之后，才能从本地获取到好友列表。
:::

### 导入好友列表

你可以[调用 REST API](/document/server-side/user_relationship.html#导入好友列表) 一次性导入多个好友。

### 双向校验好友关系  // TODO：内部有，没对外，王哲建议不对外暴露。

即时通讯 IM 支持双向校验好友管理。例如，用户 A 和 B 为好友关系，即时通讯 IM 既检查用户 A 的联系人列表上是否有用户 B，也会检查用户 B 的联系人列表上是否有用户 A。

## 开启或关闭发送消息权限控制

单聊用户之间的消息通讯，包括好友之间和陌生人之间的通讯。例如，对于企业内部的移动办公 app 来说，企业内部同事之间可以互相发送消息，可能不需要消息发送权限控制，而对于一个交友类 app，可能要控制只有好友之间才能发送消息，陌生人之间若要发消息，需要发送好友邀请，同意加好友后才能发消息。

环信即时通信 IM 默认支持陌生人之间发送单聊消息，即无需添加好友即可聊天。若仅允许好友之间发送单聊消息，你需要按以下步骤开启好友关系检查。

1. 在环信即时通讯云的左侧导航栏中，选择 **即时通讯** > **服务概览**。
2. 在 **设置** 区域，点击 **好友关系检查**对应的 **打开**，则该功能的状态为**已开启**。若关闭该功能，点击 **关闭**。
   该功能开启后，SDK 会在用户发起单聊时检查好友关系，若用户向陌生人发送单聊消息，SDK 会提示错误码 221。

## 黑名单

每个用户都有一份黑名单，用于保存被拉黑的用户。

用户可以将任何用户加入黑名单，不论该用户与你是否是好友关系。黑名单上的用户无法向你发送消息，也无法发送好友申请。好友被加入黑名单后仍在好友列表上显示。

黑名单最多可添加 500 个用户。

你可以[添加用户到黑名单](/document/android/user_relationship.html#添加用户到黑名单)、[将用户从黑名单移除](/document/android/user_relationship.html#将用户从黑名单移除)以及[从服务器和本地数据库获取黑名单](/document/android/user_relationship.html#从服务器获取黑名单列表)。

// TODO：没有单向和双向校验黑名单关系的功能？












